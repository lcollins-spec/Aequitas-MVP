# Aequitas-MVP

A real estate investment platform for analyzing multifamily properties, risk assessment, and deal management.

## Table of Contents
- [Local Development](#local-development)
- [Deployment to Render](#deployment-to-render)
- [Environment Variables](#environment-variables)

---

## Local Development

This guide explains how to run the backend (Flask) and frontend (Vite/React) locally.

### Prerequisites
- Python 3.10+ and pip
- Node.js & npm (install via Homebrew: `brew install node` or from https://nodejs.org)

### Backend
1. Install Python deps:
   ```bash
   cd backend
   python3 -m pip install -r requirements.txt
   ```
2. Start the backend (development):
   ```bash
   # dev server (foreground) — this repo often uses port 5002 in examples
   PORT=5002 python3 run.py
   # or in background (use gunicorn for production-like runs)
   gunicorn -b 0.0.0.0:5002 "app:create_app()" --workers 2 --log-file -
   ```

### Frontend
1. Install Node deps and start Vite dev server:
   ```bash
   cd frontend
   npm install
   npm run dev
   ```
2. The frontend dev server runs on http://127.0.0.1:5173 by default.
   The dev Vite config proxies requests starting with `/api` to the
   backend. You can override the proxy target with the `BACKEND_URL`
   environment variable when starting the frontend. Example:

   ```bash
   # point Vite to a backend running on port 5002
   BACKEND_URL=http://localhost:5002 npm run dev
   ```

### Notes
- If port 5000 is in use by macOS services, the backend will fail to bind — use `PORT=5001` or another free port.
- If you run the Flask dev server in background (nohup) the reloader can crash due to TTY/termios; run without the reloader or use gunicorn for background runs.

---

## Deployment to Render

This application is configured for easy deployment to Render using Docker with PostgreSQL.

### Architecture
- **Single Docker container** serves both API and frontend static files
- **PostgreSQL database** (Render managed, 512MB free tier)
- **Free tier eligible** for both web service and database
- **Dual database support**: PostgreSQL in production, SQLite for local development

### Quick Deploy

#### Option 1: Using render.yaml Blueprint (Recommended)
1. Push your code to GitHub
2. Create account at [render.com](https://render.com)
3. Click "New +" → "Blueprint"
4. Connect your GitHub repository
5. Render will automatically:
   - Create PostgreSQL database (`aequitas-db`)
   - Create web service (`aequitas-mvp`)
   - Link them with DATABASE_URL
6. Set the required API keys in the environment variables (see below)
7. Click "Apply" to deploy
8. Wait 5-10 minutes for build and database initialization

#### Option 2: Manual Setup
1. Create account at [render.com](https://render.com)

2. **Create PostgreSQL Database First:**
   - Click "New +" → "PostgreSQL"
   - **Name**: `aequitas-db`
   - **Region**: Oregon (or your preferred region)
   - **PostgreSQL Version**: 15 (or latest)
   - **Plan**: Free
   - Click "Create Database"
   - Wait for database to initialize

3. **Create Web Service:**
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - **Name**: `aequitas-mvp`
   - **Runtime**: Docker
   - **Dockerfile Path**: `./Dockerfile`
   - **Region**: Oregon (same as database)
   - **Instance Type**: Free

4. **Link Database to Web Service:**
   - In web service settings, go to "Environment"
   - Add environment variable:
     - **Key**: `DATABASE_URL`
     - **Value**: Click "Add from Database" → Select `aequitas-db`

5. Set other environment variables (see below)
6. Click "Create Web Service"

### Required Environment Variables

Set these in the Render dashboard under "Environment":

```bash
SECRET_KEY=<generate-with-python-c-import-secrets-print-secrets-token-hex-32>
FLASK_ENV=production
FLASK_DEBUG=0
CENSUS_API_KEY=<your-census-api-key>
FRED_API_KEY=<your-fred-api-key>
RENTCAST_API_KEY=<your-rentcast-api-key>
FRONTEND_URL=https://aequitas-mvp.onrender.com  # Update with your actual Render URL
# DATABASE_URL is automatically set by Render when you link the PostgreSQL database
```

**Important:** The `DATABASE_URL` environment variable is automatically generated by Render when you create and link the PostgreSQL database service. You do NOT need to set this manually.

To generate a secure `SECRET_KEY`:
```bash
python3 -c "import secrets; print(secrets.token_hex(32))"
```

### Testing the Deployment

After deployment completes:

```bash
# Replace with your Render URL
RENDER_URL="https://aequitas-mvp.onrender.com"

# Test health check
curl $RENDER_URL/api/v1/ping

# Test frontend
curl $RENDER_URL

# Test API endpoint
curl $RENDER_URL/api/v1/deals
```

### Local Docker Testing (Optional)

If you have Docker installed, you can test the Docker build locally:

```bash
# Build image
docker build -t aequitas-mvp .

# Run locally
docker run -p 10000:10000 \
  -e SECRET_KEY=test-secret-key \
  -e CENSUS_API_KEY=your-key \
  -e FRED_API_KEY=your-key \
  -e RENTCAST_API_KEY=your-key \
  -v $(pwd)/data:/app/data \
  aequitas-mvp

# Test at http://localhost:10000
```

### Render Free Tier Limitations

**Web Service:**
- 512 MB RAM (suitable for low-medium traffic)
- Shared CPU
- Sleeps after 15 minutes of inactivity (30-60s cold start)

**PostgreSQL Database:**
- 512 MB storage
- 5 concurrent connections max
- Expires after 90 days of inactivity
- 7-day automated backups

**Upgrade Path:**
- Web Service Starter: $7/month (always on, 2GB RAM)
- PostgreSQL Starter: $7/month (1GB storage, always on)
- Total: $14/month for production-grade service

---

## Environment Variables

### Development
Create a `.env` file in the `backend/` directory:

```bash
FLASK_DEBUG=1
FLASK_ENV=development
SECRET_KEY=dev-secret-key

# External API Keys
CENSUS_API_KEY=your-census-api-key
FRED_API_KEY=your-fred-api-key
RENTCAST_API_KEY=your-rentcast-api-key

# Frontend Configuration
FRONTEND_URL=http://localhost:5173

# Database (optional - defaults to SQLite if not set)
# DATABASE_URL=sqlite:///aequitas.db  # Local SQLite (default)
# DATABASE_URL=postgresql://user:pass@localhost:5432/aequitas_dev  # Local PostgreSQL
```

**Note:** In local development, the application automatically uses SQLite unless you explicitly set `DATABASE_URL` to a PostgreSQL connection string.

### Production
Set these in your hosting platform's environment variables dashboard:
- All the variables listed above
- Set `FLASK_DEBUG=0` and `FLASK_ENV=production`
- Use a strong `SECRET_KEY`
- Set `FRONTEND_URL` to your production domain

### API Keys
- **Census API**: Get a free key at https://api.census.gov/data/key_signup.html
- **FRED API**: Get a free key at https://fred.stlouisfed.org/docs/api/api_key.html
- **RentCast API**: Sign up at https://www.rentcast.io/
